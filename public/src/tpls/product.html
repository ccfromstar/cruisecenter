<div ui-view="nav"></div>
<link rel="stylesheet" href="http://www.imptrip.com/pc/css/public.css" />
<link rel="stylesheet" href="../src/css/index.css" />
<div class="center content_page">
	<!--
	<img class="pro_img" src="../../src/image/product3.jpg" alt="" />
	<img class="pro_img" src="../../src/image/product1.jpg" alt="" />
	<img class="pro_img" src="../../src/image/product.jpg" alt="" />
	<img class="pro_img" src="../../src/image/product2.jpg" alt="" />
	-->
	<div class="prd_list">
		<!-- 幻灯图片 -->
		<div class="slide_p">
			<ul id="bigSlideUl" class="slide-ul clearfix">

				<li ng-repeat="item in items">
					<a class="picimglink" href="/src/#/index/detail?p={{ item.id }}" target="_blank">
						<img src="{{ item.img }}" alt="邮轮图片" class="producetion" />
						<div class="font-main">
							<div class="font-main_title"><span>{{ item.title }}</span></div>
							<!--<div class="font-main_english">Quantum of the seas</div>
							<div class="font-main_mains" title="上海-福冈-上海">上海-福冈-上海</div>-->
							<div class="font-main_mains">{{ item.startDate }}{{ item.startLocation }}出发</div>
							<div><small class="color-orange">￥</small><span class="price_list color-orange">{{ item.price }}</span><small>起/人</small></div>
						</div>
					</a>
				</li>
				
				
		</div>
		<!-- 幻灯焦点 -->
		<ul id="smallSlideUl" class="info-btn clearfix">

		</ul>
		<em class="tab-shadow"></em>

	</div>
</div>
<div class="searchArea" style="display:none">
	<div class="center ">
		<!--查询功能-->
		<form class="am-form" id="searchForm">

			<div class="am-form-group">
				<select style="width:130px" data-am-selected id="txtCompanyName" onchange="loadShip()">
					<option value="*">邮轮公司</option>
				</select>
			</div>
			<div class="am-form-group">
				<select style="width:130px" data-am-selected id="txtCruise">
					<option value="*">船名</option>
					<option value="*">请先选择邮轮公司</option>
				</select>
			</div>
			<div class="am-form-group">
				<select style="width:95px" data-am-selected id="port">
					<option value="*">出发港</option>
				</select>
			</div>
			<div class="am-form-group">
				<input type="text" class="am-form-field" id="startdate1" style="cursor:pointer" readonly placeholder="出发日期（开始）" class="Wdate" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})"></input>
				<input type="text" class="am-form-field" id="startdate2" style="cursor:pointer" readonly placeholder="出发日期（结束）" class="Wdate" onfocus="WdatePicker({dateFmt:'yyyy-MM-dd'})"></input>
			</div>
			<div class="am-form-group">
				<select style="width:100px" data-am-selected id="day">
					<option value="*">天数</option>
				</select>
			</div>
			<div class="am-form-group">
				<button type="button" class="am-btn am-btn-primary am-radius searchByKey" onclick="comboxSearch()">查询</button>
				<button type="button" class="am-btn am-btn-default am-radius" onclick="resetFrom()">重置</button>
			</div>
			<div class="am-alert am-alert-danger none errorinfo" data-am-alert></div>

		</form>
	</div>
	<div class="center ">
		<div id="result_combox"></div>
	</div>
</div>

<div class="center content_page">
	<div>
		<h2 class="container">邮轮品牌</h2>
		<ul class="pinpai">
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/1.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/2.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/3.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/4.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/5.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/6.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/7.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/8.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/9.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/10.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/11.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/12.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/13.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/14.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/15.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/16.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/17.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/18.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/19.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/20.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/21.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/22.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/23.jpg" alt="音谱旅行"></li>
			<li><img src="http://www.imptrip.com/pc/images/shiplogo/24.jpg" alt="音谱旅行"></li>
		</ul>
	</div>
</div>
<script>
	var load = '<ul id="ajax_list" class="am-list"><li>数据查询中... <i class="am-icon-spinner am-icon-pulse"></i></li></ul>';
	var loadcompany = '<option value="*">邮轮公司</option><option value="*">数据加载中...</option>';
	var loadship = '<option value="*">船名</option><option value="*">数据加载中...</option>';
	var defaultship = '<option value="*">船名</option><option value="*">请先选择邮轮公司</option>';
	var loadport = '<option value="*">出发港</option><option value="*">数据加载中...</option>';
	var url = window.location.href;
	var loadinfo = "加载中...";

	loadCompany();
	loadPort();
	loadDay();
	/*
	if(window.sessionStorage.getItem("data_4_1")){
		$('#startdate1').datepicker('setValue', window.sessionStorage.getItem("data_4_1"));
	}
	if(window.sessionStorage.getItem("data_4_2")){
		$('#startdate2').datepicker('setValue', window.sessionStorage.getItem("data_4_2"));
	}*/

	/*加载邮轮公司选项*/
	function loadCompany() {
		//显示数据加载层
		$("#txtCompanyName").html(loadcompany);
		$.ajax({
			type: "POST",
			url: "http://www.huiyoulun.com:8088/service/getAllCompany",
			success: function(data) {
				var res = '<option value="*">邮轮公司</option>';
				for(var i in data) {
					res += '<option value="' + data[i].txtCompanyNo + '|' + data[i].txtCompanyName + '">' + data[i].txtCompanyName + '</option>';
				}
				$("#txtCompanyName").html(res);
				//$('#txtCompanyName').val(window.sessionStorage.getItem("data_1"));
			}
		});
	}

	/*加载出发港选项*/
	function loadPort() {
		//显示数据加载层
		$('#port').html(loadport);
		$.ajax({
			type: "POST",
			url: "http://www.huiyoulun.com:8088/service/getPort",
			success: function(data) {
				var res = '<option value="*">出发港</option>';
				for(var i in data) {
					res += '<option value="' + data[i].name + '">' + data[i].name + '</option>';
				}
				$("#port").html(res);
				//$('#port').val(window.sessionStorage.getItem("data_3"));
			}
		});
	}

	/*加载天数*/
	function loadDay() {
		var res = '<option value="*">天数</option>';
		for(var i = 3; i < 10; i++) {
			res += '<option value="' + i + '">' + i + '天</option>';
		}
		res += '<option value="10">10天以上</option>';
		$("#day").html(res);
		//$('#day').val(window.sessionStorage.getItem("data_5"));
	}

	/*加载船名选项*/
	function loadShip() {
		//显示数据加载层
		$('#txtCruise').html(loadship);
		var cno = $('#txtCompanyName').val();
		var arr = cno.split('|');
		if(cno == '*') {
			$('#txtCruise').html(defaultship);
			return false;
		}
		$.ajax({
			type: "POST",
			url: "http://www.huiyoulun.com:8088/service/getShipByCompanyNo",
			data: {
				txtCompanyNo: arr[0]
			},
			success: function(data) {
				var res = '<option value="*">船名</option>';
				for(var i in data) {
					res += '<option value="' + data[i].txtShipName + '">' + data[i].txtShipName + '</option>';
				}
				$("#txtCruise").html(res);
				//$('#txtCruise').val(window.sessionStorage.getItem("data_2"));
			}
		});
	}

	/*组合查询条件重置*/
	function resetFrom() {
		window.sessionStorage.removeItem("data_1");
		window.sessionStorage.removeItem("data_2");
		window.sessionStorage.removeItem("data_3");
		window.sessionStorage.removeItem("data_4_1");
		window.sessionStorage.removeItem("data_4_2");
		window.sessionStorage.removeItem("data_5");

		$('#startdate1').val('');
		$('#startdate2').val('');
		loadCompany();
		loadPort();
		loadShip();
		loadDay();

	}

	/*组合查询*/
	function comboxSearch() {
		var data_1 = $('#txtCompanyName').val();
		var arr = data_1.split('|');
		var data_2 = $('#txtCruise').val();
		var data_3 = $('#port').val();
		var data_4_1 = $('#startdate1').val();
		var data_4_2 = $('#startdate2').val();
		var data_5 = $('#day').val();
		/*set sessionStorage*/
		window.sessionStorage.setItem("data_1", data_1);
		window.sessionStorage.setItem("data_2", data_2);
		window.sessionStorage.setItem("data_3", data_3);
		window.sessionStorage.setItem("data_4_1", data_4_1);
		window.sessionStorage.setItem("data_4_2", data_4_2);
		window.sessionStorage.setItem("data_5", data_5);
		if(data_1 == '*' && data_2 == '*' && data_3 == '*' && data_4_1 == '' && data_4_2 == '' && data_5 == '*') {
			$('.errorinfo').html('<p>最少要选择一个查询条件</p>').removeClass("none");
			setTimeout(function() {
				$('.errorinfo').addClass("none");
			}, 2000);
			return false;
		}
		if(data_4_1 != '' && data_4_2 != '' && data_4_1 > data_4_2) {
			$('.errorinfo').html('<p>结束日期不能大于开始日期</p>').removeClass("none");
			setTimeout(function() {
				$('.errorinfo').addClass("none");
			}, 2000);
			return false;
		}

		//显示数据加载层
		$("#result_combox").html(load);
		$.ajax({
			type: "POST",
			url: "http://www.huiyoulun.com:8088/service/SearchByComboxKey",
			data: {
				data_1: data_1 == '*' ? "*" : arr[1],
				data_2: data_2,
				data_3: data_3,
				data_4_1: data_4_1,
				data_4_2: data_4_2,
				data_5: data_5,
				option_2: 'txtStartDate'
			},
			success: function(data) {
				var res = '<ul class="am-list">';
				for(var i in data) {
					if(data[i].txtSource == '踏破铁鞋') {
						var p = data[i].numPrice;
						if(p == 0) {
							p = '售罄';
						} else if(p == -1) {
							p = '实时计价';
						} else {
							p = "¥" + p + "起";
						}
						if(data[i].txtSource == '踏破铁鞋') {
							res += '<li onclick="showDetail(\'' + data[i].txtUrl + '\')">';
						} else {
							res += '<li onclick="window.open(\'' + data[i].txtUrl + '\')">';
						}
						if(data[i].txtSource == '驴妈妈' || data[i].txtSource == '途牛' || data[i].txtSource == '春秋') {
							res += '<h1>' + data[i].title + '</h1>';
						} else if(data[i].txtSource == '同程' || data[i].txtSource == '众信') {
							res += '<h1>' + data[i].title + ' ' + data[i].txtStartDate + '</h1>';
						} else {
							res += '<h1> 【' + data[i].txtCompany + '-' + data[i].txtCruise + '】';
							res += data[i].txtLine + ' ';
							res += data[i].txtStartDate + ' ' + data[i].numNight + '晚' + data[i].numDay + '天</h1>';
							/*
							res += '<h1><span class="am-badge am-badge-success am-radius ">' + data[i].txtSource + '</span> ' + data[i].txtCompany + '-' + data[i].txtCruise + '</h1>';
							res += '<h2>邮轮线路：' + data[i].txtLine + '</h2>';
							res += '<h2>出发日期：' + data[i].txtStartDate + ' ' + data[i].numNight + '晚' + data[i].numDay + '天</h2>';
							*/
						}
						res += '<span class="price am-badge am-badge-warning am-radius ">' + p + '</span>';
						res += '</li>';
					}
				}
				res += '</ul>';
				$("#result_combox").html(res);
			}
		});
	}

	/*显示产品详情*/
	function showDetail(url) {
		window.open('/src/#/index/detail?p=' + url);
	}
</script>