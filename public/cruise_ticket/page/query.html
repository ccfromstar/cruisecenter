<!doctype html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>上海港邮轮登船凭证管理系统(SCSPMS)</title>

		<link rel="stylesheet" href="../framework/amazeui/amazeui.min.css" />

		<script src="../framework/jquery-1.9.1.js"></script>
		<script src="../framework/amazeui/amazeui.min.js"></script>

		<script src="../framework/main.js"></script>

		<link rel="stylesheet" href="../framework/css/admin.css">
		<script type="text/javascript">

			$(function(){
				
			});

			var lineId = '';

			var idlist = '';
			var namelist = '';

			function search(){
				$.ajax({
					type: "post",
					url: "/service/getVistor",
					data: {
						companyId:sessionStorage.companyId,
						startDate:$("#startDate").val(),
						teamNo:$("#teamNo").val(),
						uname:$("#uname").val()
					},
					success: function(data) {
						var arr = data.split("|");
						$("#total").html(arr[0]);
						var arr1 = arr[1].split("@");
						var arr2 = arr[2].split("@");
						var arr3 = arr[3].split("@");
						var arr4 = arr[4].split("@");
						var arr5 = arr[5].split("@");
						var arr6 = arr[6].split("@");
						var arr7 = arr[7].split("@");
						var arr8 = arr[8].split("@");
						var arr9 = arr[9].split("@");
						var json_tbody = '';
						for(var i=1;i<arr1.length;i++){
							json_tbody += '<tr>';
							json_tbody += '<td></td>';
							json_tbody += '<td></td>';
							json_tbody += '<td></td>';
							json_tbody += '<td>'+arr5[i]+'</td>';
							json_tbody += '<td>'+arr2[i]+'</td>';
							json_tbody += '<td></td>';
							json_tbody += '<td>'+arr1[i]+'</td>';
							json_tbody += '<td>'+arr3[i]+'</td>';
							json_tbody += '<td>'+arr4[i]+'</td>';
							json_tbody += '<td>'+arr6[i]+'</td>';
							json_tbody += '<td>'+arr7[i]+'</td>';
							json_tbody += '<td>'+arr8[i]+'</td>';
							json_tbody += '</tr>';
						}
						$("#json_tbody").html(json_tbody);
						idlist = (arr[9]);
						namelist = arr[1];
					}
				});
			}

			function createTicket(){
				$.ajax({
					type: "post",
					url: "/service/createTicket",
					data: {
						idlist:idlist
					},
					success: function(data) {
						alert("生成成功");
						console.log(data);
						var tlist = '';
						var arrT = idlist.split("@");
						var arrN = namelist.split("@");
						for(var i=1;i<arrT.length;i++){
							tlist = tlist+"<a target='blank' href='http://39.104.66.119/static/"+arrT[i]+".pdf'>"+arrN[i]+".pdf</a>&nbsp;&nbsp;&nbsp;";
						}
						$('#ticketlist').html(tlist);
						var $modal = $('#doc-modal-1');
						$modal.modal('toggle');
					}
				});
			}
		</script>
	</head>

	<body>
		<div>
			<header class="am-topbar am-topbar-inverse admin-header">
				<div class="am-topbar-brand">
					<strong>上海港邮轮登船凭证管理系统</strong> <small>(SCSPMS)</small>
				</div>

				<button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>

				<div class="am-collapse am-topbar-collapse" id="topbar-collapse">

					<ul class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list">
						<li><a href="javascript:;"><span class="am-icon-user"></span> 当前用户 <span id="cname"></span></a></li>
						<li><a href="#" onclick="exitUser()"><span class="am-icon-power-off"></span> 退出</a></li>
					</ul>
				</div>
			</header>
			<div class="am-cf admin-main">
				<!-- sidebar start -->
				<div class="admin-sidebar am-offcanvas" id="admin-offcanvas">
					<div class="am-offcanvas-bar admin-offcanvas-bar">
						<ul class="am-list admin-sidebar-list">
							<li><a href="import.html"><span class="am-icon-pencil-square-o"></span> 游客信息导入</a></li>
							<li><a href="query.html"><span class="am-icon-pencil-square-o"></span> 游客信息查询</a></li>
							<li><a href="line.html"><span class="am-icon-pencil-square-o"></span> 航班信息维护</a></li>
						</ul>
					</div>
				</div>
				<!-- sidebar end -->
				<!-- content start -->
				<div class="admin-content" ng-controller="AdminController">
					<div class="admin-content-body">
						
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-primary am-text-lg">游客信息</strong> / <small>列表</small></div>
						</div>
						<!--
						<div class="am-g">
							<div class="am-u-sm-12 am-u-md-6">
					          <div class="am-btn-toolbar">
					            <div class="am-btn-group am-btn-group-xs">
					              <button type="button" class="am-btn am-btn-default"><span class="am-icon-plus"></span> 新增游客</button>
					            </div>
					          </div>
					        </div>
					        <div class="am-u-sm-12 am-u-md-3">
					          <div class="am-form-group">
					           		<select style="display:inline;width:200px;">
										<option>2017-12-06 盛世公主号</option>
										<option>2017-12-06 赛琳娜号</option>
									</select>
					          </div>
					        </div>
					        <div class="am-u-sm-12 am-u-md-3">
					          <div class="am-input-group am-input-group-sm">
					            <input type="text" class="am-form-field" placeholder="姓名，护照号">
					          <span class="am-input-group-btn">
					            <button class="am-btn am-btn-default" type="button">搜索</button>
					          </span>
					          </div>
					        </div>
					      </div>-->

					      <div style="margin-left:30px">
					      	<input type="text" id="startDate" class="am-form-field" style="width:120px;display: inline-block;" placeholder="出发日期" data-am-datepicker readonly />
					      	<input type="" id="teamNo" class="am-form-field" style="width:120px;display: inline-block;" placeholder="团号" >
					      	<input type="" id="uname" class="am-form-field" style="width:120px;display: inline-block;" placeholder="姓名" >
					      	<button type="button" onclick="search()" class="btn-c am-btn am-btn-primary am-btn">检索</button>
					      	<button type="button" onclick="createTicket()" class="btn-c am-btn am-btn-default am-btn">批量生成船票</button>
					      </div>


							<div class="am-g">
								<div class="am-u-sm-12">
									<form class="am-form">
										<table class="am-table am-table-striped am-table-hover table-main jdt-table">
											<thead>
												<tr>
													<th>船票认证码</th>
													<th>预定编号</th>
													<th>船舱楼层</th>
													<th>团号</th>
													<th>房间号码</th>
													<th>逃生集合区</th>
													<th>姓名</th>
													<th>英文姓名</th>
													<th>国籍</th>
													<th>护照号</th>
													<th>身份证号</th>
													<th>联系电话</th>
												</tr>
											</thead>
											<tbody id="json_tbody">
												
											</tbody>
										</table>
										<div class="am-cf">
											共<span id="total"></span>条记录
											<div class="am-fr">
												<ul class="am-pagination" id="pagination">
													
												</ul>
											</div>
										</div>
									</form>
								</div>
							</div>
							<div class="am-modal am-modal-confirm" tabindex="-1" id="del-confirm">
								<div class="am-modal-dialog">
									<div class="am-modal-hd">提示</div>
									<div class="am-modal-bd">
										你，确定要删除这条记录吗？
									</div>
									<div class="am-modal-footer">
										<span class="am-modal-btn" data-am-modal-cancel>取消</span>
										<span class="am-modal-btn" data-am-modal-confirm onClick="delDoc(4)">确定</span>
									</div>
								</div>
							</div>
						</div>
						</div>

					</div>
				</div>
				<!-- content end -->
			</div>
		</div>

		<div class="am-modal am-modal-no-btn" tabindex="-1" id="doc-modal-1">
		  <div class="am-modal-dialog">
		    <div class="am-modal-hd">船票列表
		      <a href="javascript: void(0)" class="am-close am-close-spin" data-am-modal-close>&times;</a>
		    </div>
		    <div id="ticketlist" class="am-modal-bd">
		        
		    </div>
		  </div>
		</div>

	</body>

</html>